<?php

namespace App\Console\Commands;

use App\Models\Scheme;
use Illuminate\Console\Command;

class UpdateSchemeDivision extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'app:update-scheme-division';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description';

    /**
     * Execute the console command.
     */
    public function handle()
    {
        $ids = [
            8223776,
            8223749,
            8227142,
            8227239,
            8226896,
            8227346,
            8227279,
            8224473,
            8224464,
            5253604,
            8226997,
            8224613,
            8223728,
            8223647,
            8226894,
            6175525,
            8226810,
            8227152,
            8224402,
            8237915,
            8223625,
            8158852,
            8224670,
            8223436,
            8224421,
            8224913,
            8227216,
            8224387,
            8227324,
            8226932,
            8224522,
            8227164,
            8224835,
            8224487,
            8223484,
            8224633,
            8227270,
            8145709,
            8158783,
            8227204,
            8164347,
            8145739,
            5253562,
            8224560,
            8223699,
            8225973,
            8224829,
            8224445,
            8224935,
            8224588,
            8226868,
            8225993,
            8224780,
            8238852,
            8223660,
            8224758,
            8158834,
            8224645,
            8224574,
            8238892,
            6530085,
            8224808,
            8227225,
            8227300,
            8224544,
            8226845,
            8224691,
            3361536,
            8223825,
            6198983,
            8158690,
            6151109,
            8238806,
            8158771,
            5253622,
            8238815,
            8164222,
            8164327,
            8164314,
            8164284,
            6175681,
            8164246,
            6217983,
            6199219,
            8238863,
            8158668,
            8158657,
            8158681,
            6188515,
            8158868,
            8238831,
            4601789,
            8164297,
            8224505,
            8224505,
            8224650,
            8238887,
            8164404,
            8224849,
            8227191,
            30074543,
            30077098,
            30205054,
            30079371,
            30074749,
            30077142,
            30074491,
            30077149,
            30077805,
            30074434,
            30079379,
            30074338,
            30074371,
            30077105,
            30077127,
            30079375,
            30074485,
            30079365,
            30077124,
            30077154,
            30079523,
            30074499,
            30074335,
            30074469,
            30077765,
            30074730,
            30074459,
            30074548,
            30079377,
            30073367,
            30076955,
            30079380,
            30079557,
            30074495,
            30077809,
            30074746,
            30073360,
            30079378,
            30076944,
            30073349,
            30074738,
            30072636,
            30076935,
            30074731,
            30074343,
            30074530,
            30074525,
            30079374,
            30115375,
            30074337,
            30074433,
            30074689,
            30077768,
            30077772,
            30077078,
            30074528,
            30079512,
            30077774,
            30079381,
            30079383,
            30074449,
            30077797,
            30077108,
            30074461,
            30074540,
            30074497,
            30074686,
            30074444,
            30074454,
            30076921,
            30077801,
            30077001,
            30077137,
            30079376,
            30074544,
            30074683,
            30077010,
            30077777,
            30174409,
            30174367,
            30077058,
            30079384,
            30074742,
            30074479,
            30077133,
            30077780,
            30074664,
            30074493,
            30074662,
            30074494,
            30077114,
            30077793,
            30076995,
            30077800,
            30074336,
            30074661,
            30079372,
            30079385,
            30077023,
            30077804,
            30074393,
            30079373,
            30205198,
            30205097,
            30074542,
            30205126,
            30074341,
            30074660,
            30077044,
            30074533,
            30073355,
            30077109,
            30074339,
            30077117,
            30074389,
            30077071,
            30074527,
            30077795,
            30189203,
            30202250,
            30189152,
            30188653,
            30202267,
            30195643,
            30202303,
            30189227,
            30244771,
            30188759,
            30188744,
            30202225,
            30188839,
        ];

        $progressBar = $this->output->createProgressBar(count($ids));
        $this->line('Scheme Division Update with Jal-Mitra and SO user Update...');
        $progressBar->start();

        foreach ($ids as $id) {
            $scheme = Scheme::query()
                ->with('user.divisions')
                ->where('imis_id', $id)->first();
            if ($scheme) {
                $scheme->update([
                    'division_id' => '01h2wr58mdb4jx0vb8sg74ftqb',
                ]);
                $scheme->user?->divisions()?->sync('01h2wr58mdb4jx0vb8sg74ftqb');
                foreach ($scheme->users as $user) {
                    $user?->divisions()?->sync('01h2wr58mdb4jx0vb8sg74ftqb');
                }
                $progressBar->advance();
            }
        }
        $progressBar->finish();
        $this->line('');
    }
}
